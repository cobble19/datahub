<configuration scan="true" scanPeriod="120 seconds">

    <property name="LOG_DIR" value="${LOG_DIR:-/tmp/datahub/logs/gms}"/>

    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36}:%L - %msg%n</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
    </appender>

    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_DIR}/gms.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <FileNamePattern>${LOG_DIR}/gms.%d{yyyy-dd-MM}-%i.log</FileNamePattern>
            <maxFileSize>100MB</maxFileSize>
            <totalSizeCap>10GB</totalSizeCap>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <encoder>
            <pattern>%d{HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <appender name="DEBUG_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_DIR}/gms.debug.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <FileNamePattern>${LOG_DIR}/gms.debug.%d{yyyy-dd-MM}-%i.log</FileNamePattern>
            <maxFileSize>100MB</maxFileSize>
            <totalSizeCap>2GB</totalSizeCap>
            <maxHistory>1</maxHistory>
        </rollingPolicy>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>DEBUG</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <encoder>
            <pattern>%d{HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <appender name="MATS_ES_INFO" class="com.webex.mats.logback.ElasticAppender">
        <esURL>${ES_API_URL:-https://esaaslab-esbtpt1-s.webex.com/esapi}</esURL>
        <esIndex>${ES_LOG_INDEX:-mats_datahub_logs}</esIndex>
        <esUserName>${ES_USERNAME}</esUserName>
        <esPassword>${ES_PASSWORD}</esPassword>
        <intervalSecs>${ES_LOG_INTERVAL:-1}</intervalSecs>
        <hostName>${HOST_NAME}</hostName>
        <appName>${APP_NAME:-GMS}</appName>
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
    </appender>

    <appender name="MATS_ES_DEBUG" class="com.webex.mats.logback.ElasticAppender">
        <esURL>${ES_API_URL:-https://esaaslab-esbtpt1-s.webex.com/esapi}</esURL>
        <esIndex>${ES_LOG_INDEX:-mats_datahub_debug}</esIndex>
        <esUserName>${ES_USERNAME}</esUserName>
        <esPassword>${ES_PASSWORD}</esPassword>
        <intervalSecs>${ES_LOG_INTERVAL:-1}</intervalSecs>
        <hostName>${HOST_NAME}</hostName>
        <appName>${APP_NAME:-GMS}</appName>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>DEBUG</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <appender name="MATS_WEBEX" class="com.webex.mats.logback.WebexAlertAppender">
        <messageApiURL>${WBX_API:-https://api.ciscospark.com/v1/messages}</messageApiURL>
        <roomId>${WBX_ROOM_ID:-Y2lzY29zcGFyazovL3VzL1JPT00vNGZiNzg2ODAtZDdkYi0xMWVjLWExYzYtY2RmNGFiOWI5Y2Vk}</roomId>
        <kibanaLink>${WBX_KIBANA_LINK:-https://esaaslab-esbtpt1-s.webex.com/mats/goto/8d3a78cc2a92055cff21a92a44f782f4}</kibanaLink>
        <alertPersonEmail>${WBX_ALERT_EMAIL:-csg-mats-data@cisco.com}</alertPersonEmail>
        <botBearToken>${WBX_BOT_TOKEN:-MTlkNDQwYjktN2QzYS00ODY4LWEzZDctNGUwNjk3OThmOWJhNjU1MDZmMmUtMWJh_PF84_1eb65fdf-9643-417f-9974-ad72cae0e10f}</botBearToken>
        <intervalMins>${WBX_ALERT_INTERVAL:-30}</intervalMins>
        <hostName>${HOST_NAME}</hostName>
        <messageExclusionPattern>${WBX_ALERT_EXCLUSION_PATTERN:-Unable to renew the session.*}</messageExclusionPattern>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <root level="INFO">
        <appender-ref ref="STDOUT" />
        <appender-ref ref="FILE"/>
        <appender-ref ref="MATS_ES_DEBUG"/>
        <appender-ref ref="MATS_ES_INFO"/>
        <appender-ref ref="MATS_WEBEX"/>
    </root>

</configuration>